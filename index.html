<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CineMax</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">

    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Firebase Compat -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #000; color: #fff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; margin: 0; -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fade-in { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        #loader { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; align-items: center; justify-content: center; flex-direction: column; }
        .spinner { width: 40px; height: 40px; border: 4px solid #333; border-top: 4px solid #E50914; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div id="loader">
        <div class="spinner"></div>
        <div style="color:#666; font-size: 12px;">Loading CineMax...</div>
    </div>
    <div id="root"></div>

    <script>
        setTimeout(() => { const el = document.getElementById('loader'); if(el) el.style.display = 'none'; }, 5000);
    </script>

    <script type="text/babel">
        // --- FIREBASE CONFIG (Paste if you have it, else it runs offline) ---
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyBIHCzFY15p1AhD9wwPXS5ugrfVEptEImo",
            authDomain: "cinemax-a3597.firebaseapp.com",
            projectId: "cinemax-a3597",
            storageBucket: "cinemax-a3597.firebasestorage.app",
            messagingSenderId: "603071324966",
            appId: "1:603071324966:web:4fc93ca00f3958c1bad7e7"
        };

        let db, auth;
        try {
            if (typeof firebase !== 'undefined' && !firebase.apps.length) {
                firebase.initializeApp(FIREBASE_CONFIG);
                db = firebase.firestore();
                auth = firebase.auth();
            }
        } catch (e) { console.warn("Offline"); }

        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // ==========================================
        // ðŸ”‘ PASTE YOUR OMDb API KEY HERE ðŸ‘‡
        // ==========================================
        const OMDB_API_KEY = "PASTE_YOUR_KEY_HERE"; 
        // ==========================================

        // --- BACKUP DATA (Shows if API Key is missing or fails) ---
        const BACKUP_DATA = [
            { Title: "Superman", Year: "2025", Poster: "https://images.unsplash.com/photo-1535156417766-3139cb801a61?q=80&w=400", imdbRating: "N/A" },
            { Title: "War 2", Year: "2025", Poster: "https://images.unsplash.com/photo-1626814026160-2237a95fc5a0?q=80&w=400", imdbRating: "N/A" },
            { Title: "Dhurandhar", Year: "2025", Poster: "https://images.unsplash.com/photo-1536440136628-849c177e76a1?q=80&w=400", imdbRating: "N/A" },
            { Title: "The Last of Us", Year: "2023", Poster: "https://m.media-amazon.com/images/M/MV5BZGUzYTI3M2EtZMmItNTZmYS00NGUyLTkzYWUyLTkzYWUyLmY0ZZmVlXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_SX300.jpg", imdbRating: "8.8" },
            { Title: "Stranger Things", Year: "2016", Poster: "https://m.media-amazon.com/images/M/MV5BMDZkYmVhNjMtNWU4MC00MDQxLWE3MjYtZGMzZWI1ZjhlNGJmXkEyXkFqcGdeQXVyMTkxNjUyNQ@@._V1_SX300.jpg", imdbRating: "8.7" },
            { Title: "Mirzapur", Year: "2018", Poster: "https://m.media-amazon.com/images/M/MV5BNjJlYjE2ODMtNDc1Ny00OTI2LTgyZTYtODNlMDQ2ZjI1OTYzXkEyXkFqcGdeQXVyNTgyNTA4MjM@._V1_SX300.jpg", imdbRating: "8.5" },
            { Title: "Family Man", Year: "2019", Poster: "https://m.media-amazon.com/images/M/MV5BMzRjZWVmMzItNTdmYS00OWEzLTgyOGUtNThiNTU2ZThlYjY0XkEyXkFqcGdeQXVyMTIxMDk2NDE4._V1_SX300.jpg", imdbRating: "8.7" }
        ];

        // --- TARGET LISTS ---
        const HITS_2025 = ["Superman", "F1", "Mickey 17", "Captain America: Brave New World", "Thunderbolts", "Blade", "Daredevil: Born Again", "Ironheart", "Wednesday", "The White Lotus", "Squid Game", "Avatar: Fire and Ash", "Tron: Ares"];
        const BOLLYWOOD = ["War 2", "Dhurandhar", "Sikandar", "Sunny Sanskari Ki Tulsi Kumari", "Kis Kisko Pyaar Karoon 2", "Lahore 1947", "Sky Force", "Housefull 5", "Alpha", "The Family Man", "Panchayat", "Mirzapur", "Paatal Lok", "Khakee: The Bengal Chapter", "Kota Factory", "Farzi"];

        const App = () => {
            const [view, setView] = useState('home');
            const [selectedMedia, setSelectedMedia] = useState(null);
            const [user, setUser] = useState(null);
            const [categories, setCategories] = useState({ spotlight: [], bollywood: [], hollywood: [], trending: [] });
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                if (auth) {
                    auth.onAuthStateChanged(u => {
                        if (u) setUser(u);
                        else auth.signInAnonymously().catch(e=>{});
                    });
                }

                const loadContent = async () => {
                    // Check for Key
                    if (OMDB_API_KEY === "1565f457" || OMDB_API_KEY === "") {
                        console.log("No Key provided, using Backup Data");
                        setCategories({
                            spotlight: BACKUP_DATA.slice(0, 3),
                            bollywood: BACKUP_DATA,
                            hollywood: BACKUP_DATA,
                            trending: BACKUP_DATA
                        });
                        setLoading(false);
                        document.getElementById('loader').style.display = 'none';
                        return;
                    }

                    try {
                        const fetchOMDB = async (title) => {
                            try {
                                const res = await fetch(`https://www.omdbapi.com/?t=${encodeURIComponent(title)}&apikey=${OMDB_API_KEY}`);
                                const data = await res.json();
                                return data.Response === "True" ? data : null;
                            } catch(e) { return null; }
                        };

                        // Fetch lists sequentially to prevent rate limiting
                        const hits = [];
                        for (const title of HITS_2025) {
                            const data = await fetchOMDB(title);
                            if(data) hits.push(data);
                        }
                        
                        const bolly = [];
                        for (const title of BOLLYWOOD) {
                            const data = await fetchOMDB(title);
                            if(data) bolly.push(data);
                        }

                        // If API fails completely, use backup
                        if (hits.length === 0 && bolly.length === 0) {
                            throw new Error("API Empty");
                        }

                        const getYear = (item) => parseInt(item.Year ? item.Year.substring(0, 4) : "2000");
                        const dateSort = (a, b) => getYear(b) - getYear(a);

                        setCategories({ 
                            spotlight: hits.filter(m => getYear(m) >= 2025).sort(dateSort),
                            bollywood: bolly.sort(dateSort),
                            hollywood: hits.filter(m => getYear(m) < 2025).sort(dateSort),
                            trending: [...hits, ...bolly].filter(m => parseFloat(m.imdbRating) > 7.5).sort(dateSort)
                        });

                    } catch(e) { 
                        console.warn("API Failed, using Backup", e);
                        setCategories({ spotlight: BACKUP_DATA, bollywood: BACKUP_DATA, hollywood: BACKUP_DATA, trending: BACKUP_DATA });
                    }
                    
                    setLoading(false);
                    document.getElementById('loader').style.display = 'none';
                };
                loadContent();
            }, []);

            const goDetails = (item) => { setSelectedMedia(item); setView('details'); window.scrollTo(0,0); };
            const goBack = () => { setView('home'); setSelectedMedia(null); };

            return (
                <div className="min-h-screen bg-black text-white pb-12 font-sans">
                    <div className={view === 'home' ? 'block' : 'hidden'}>
                        <HomeView categories={categories} loading={loading} onSelect={goDetails} />
                    </div>
                    {view === 'details' && selectedMedia && (
                        <DetailsView media={selectedMedia} onBack={goBack} user={user} />
                    )}
                </div>
            );
        };

        const HomeView = ({ categories, loading, onSelect }) => {
            const [search, setSearch] = useState("");
            const [searchResults, setSearchResults] = useState([]);
            const [isSearching, setIsSearching] = useState(false);

            const executeSearch = async () => {
                if (!search.trim()) return;
                setIsSearching(true);
                try {
                    const res = await fetch(`https://www.omdbapi.com/?s=${encodeURIComponent(search)}&apikey=${OMDB_API_KEY}`);
                    const data = await res.json();
                    if (data.Search) setSearchResults(data.Search);
                } catch(e) {}
                setIsSearching(false);
            };

            return (
                <div className="fade-in">
                    <header className="sticky top-0 z-40 bg-black/95 px-4 py-3 border-b border-white/10">
                        <div className="flex justify-between items-center mb-3">
                            <h1 className="text-2xl font-black text-red-600 tracking-tighter" onClick={()=>{setSearch(""); setSearchResults([]);}}>CINE<span className="text-white">MAX</span></h1>
                        </div>
                        <div className="flex gap-2">
                            <input 
                                className="flex-1 bg-gray-900 border border-gray-800 rounded-lg py-2.5 pl-4 text-sm focus:outline-none focus:border-red-600 text-white"
                                placeholder="Search movies..."
                                value={search}
                                onChange={e => setSearch(e.target.value)}
                                onKeyDown={e => e.key === 'Enter' && executeSearch()}
                            />
                            <button 
                                onClick={executeSearch}
                                className="bg-red-600 text-white px-4 rounded-lg font-bold text-sm active:scale-95 transition-transform"
                            >
                                {isSearching ? "..." : "GO"}
                            </button>
                        </div>
                    </header>

                    {loading ? (
                        <div className="h-[60vh] flex items-center justify-center text-gray-500">Loading Library...</div>
                    ) : searchResults.length > 0 ? (
                        <div className="p-4 grid grid-cols-3 gap-3">
                            {searchResults.map(s => <Card key={s.imdbID} item={s} onClick={onSelect} />)}
                        </div>
                    ) : (
                        <div className="pb-10 pt-4 space-y-8">
                            {categories.spotlight && categories.spotlight[0] && (
                                <div className="px-4" onClick={() => onSelect(categories.spotlight[0])}>
                                    <div className="relative aspect-video rounded-xl overflow-hidden border border-white/10 shadow-2xl bg-gray-900">
                                        <img 
                                            src={categories.spotlight[0].Poster} 
                                            className="w-full h-full object-cover opacity-60" 
                                        />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                                        <div className="absolute bottom-3 left-3 right-3">
                                            <span className="bg-red-600 text-white text-[10px] font-bold px-2 py-0.5 rounded uppercase mb-1 inline-block shadow">New 2025</span>
                                            <h2 className="text-xl font-black text-white leading-none drop-shadow-md">{categories.spotlight[0].Title}</h2>
                                        </div>
                                    </div>
                                </div>
                            )}
                            <Section title="ðŸš€ 2025 Premieres" items={categories.spotlight} onSelect={onSelect} />
                            <Section title="ðŸ‡®ðŸ‡³ Bollywood Hits" items={categories.bollywood} onSelect={onSelect} />
                            <Section title="ðŸ”¥ Global Trending" items={categories.trending} onSelect={onSelect} />
                            <Section title="ðŸŽ¬ Latest Hollywood" items={categories.hollywood} onSelect={onSelect} />
                        </div>
                    )}
                </div>
            );
        };

        const Section = ({ title, items, onSelect }) => {
            if (!items || items.length === 0) return null;
            return (
                <div className="pl-4">
                    <h3 className="text-white font-bold text-base mb-3 border-l-4 border-red-600 pl-3">{title}</h3>
                    <div className="flex overflow-x-auto gap-3 pb-4 pr-4" style={{scrollBehavior:'smooth', WebkitOverflowScrolling: 'touch'}}>
                        {items.map(item => (
                            <div key={item.imdbID || Math.random()} className="min-w-[110px] w-[110px]" onClick={() => onSelect(item)}>
                                <div className="aspect-[2/3] rounded-lg overflow-hidden relative bg-gray-900 border border-white/5">
                                    {item.Poster !== "N/A" ? 
                                        <img src={item.Poster} className="w-full h-full object-cover" loading="lazy" /> : 
                                        <div className="w-full h-full flex items-center justify-center text-xs text-gray-500 p-2 text-center">{item.Title}</div>
                                    }
                                </div>
                                <h4 className="text-gray-300 text-xs mt-1 truncate">{item.Title}</h4>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        const Card = ({ item, onClick }) => (
            <div onClick={() => onClick(item)} className="cursor-pointer">
                <div className="aspect-[2/3] rounded-lg bg-gray-900 relative overflow-hidden border border-white/10">
                    {item.Poster !== "N/A" ? <img src={item.Poster} className="w-full h-full object-cover" /> : null}
                </div>
                <div className="text-xs text-gray-400 mt-1 truncate">{item.Title}</div>
            </div>
        );

        const DetailsView = ({ media, onBack, user }) => {
            const [reviews, setReviews] = useState([]);
            const [showModal, setShowModal] = useState(false);
            
            useEffect(() => {
                if (db) {
                    const unsub = db.collection('reviews')
                        .where('mediaId', '==', String(media.imdbID || media.Title)) // Fallback to Title if ID missing
                        .onSnapshot(snap => {
                            const list = snap.docs.map(d => d.data());
                            setReviews(list.sort((a,b) => (b.timestamp?.seconds || 0) - (a.timestamp?.seconds || 0)));
                        });
                    return () => unsub();
                }
            }, [media]);

            const postReview = async (e) => {
                e.preventDefault();
                if (!user) return alert("Offline. Check internet.");
                const form = e.target;
                const data = {
                    mediaId: String(media.imdbID || media.Title),
                    userId: user.uid,
                    author: form.author.value,
                    content: form.content.value,
                    rating: parseInt(form.rating.value),
                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                };
                await db.collection('reviews').add(data);
                setShowModal(false);
            };

            return (
                <div className="min-h-screen bg-black pb-10 fade-in text-white">
                    <div className="relative w-full aspect-video">
                        {media.Poster !== "N/A" ? 
                            <img src={media.Poster} className="w-full h-full object-cover opacity-60 object-top" /> : 
                            <div className="w-full h-full bg-gray-900"></div>
                        }
                        <div className="absolute inset-0 bg-gradient-to-t from-black via-transparent to-transparent"></div>
                        <button onClick={onBack} className="absolute top-4 left-4 bg-black/50 p-2 rounded-full text-white backdrop-blur border border-white/20">Back</button>
                    </div>

                    <div className="px-5 -mt-12 relative">
                        <h1 className="text-3xl font-black leading-tight mb-3 drop-shadow-xl">{media.Title}</h1>
                        <div className="flex gap-3 text-xs font-bold text-gray-400 mb-5">
                            <span className="bg-red-600 px-2 py-0.5 rounded text-white shadow">{media.Year}</span>
                            <span className="text-white flex items-center gap-1">â˜… {media.imdbRating}</span>
                            <span>{media.Genre?.split(',')[0]}</span>
                        </div>

                        <p className="text-sm text-gray-300 leading-relaxed mb-8 border-l-2 border-gray-700 pl-3">{media.Plot}</p>

                        <div className="mb-6">
                            <h3 className="font-bold text-white text-xs uppercase tracking-wider mb-2">Cast</h3>
                            <p className="text-sm text-gray-400">{media.Actors}</p>
                        </div>

                        <div className="bg-gray-900 rounded-xl p-5 border border-white/5">
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="font-bold text-white text-sm">Reviews ({reviews.length})</h3>
                                <button onClick={()=>setShowModal(true)} className="bg-white text-black text-xs font-bold px-4 py-2 rounded-full hover:bg-gray-200">Write</button>
                            </div>
                            <div className="space-y-4">
                                {reviews.length===0 && <div className="text-center text-xs text-gray-600 py-4">Be the first to review!</div>}
                                {reviews.map((r,i) => (
                                    <div key={i} className="border-b border-gray-800 pb-3 last:border-0">
                                        <div className="flex justify-between text-xs mb-1">
                                            <span className="font-bold text-white">{r.author}</span>
                                            <span className="text-red-500 font-bold">â˜… {r.rating}</span>
                                        </div>
                                        <p className="text-xs text-gray-400 leading-relaxed">{r.content}</p>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>

                    {showModal && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4" onClick={()=>setShowModal(false)}>
                            <div className="bg-gray-900 w-full max-w-sm p-6 rounded-xl border border-gray-700 shadow-2xl" onClick={e=>e.stopPropagation()}>
                                <h3 className="font-bold text-white mb-4">Rate {media.Title}</h3>
                                <form onSubmit={postReview}>
                                    <input name="author" placeholder="Name" className="w-full bg-black border border-gray-700 rounded-lg p-3 mb-3 text-sm text-white focus:border-red-600 outline-none" required />
                                    <select name="rating" className="w-full bg-black border border-gray-700 rounded-lg p-3 mb-3 text-sm text-white focus:border-red-600 outline-none"><option value="5">5 â˜…â˜…â˜…â˜…â˜…</option><option value="4">4 â˜…â˜…â˜…â˜…</option><option value="3">3 â˜…â˜…â˜…</option><option value="2">2 â˜…â˜…</option><option value="1">1 â˜…</option></select>
                                    <textarea name="content" placeholder="Review..." className="w-full bg-black border border-gray-700 rounded-lg p-3 mb-4 text-sm text-white focus:border-red-600 outline-none" rows="3" required></textarea>
                                    <button className="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700">Post Review</button>
                                </form>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


